nstatesX2 <- c("AAxA"=1, "AAxB"=1, "ABxA"=1, "ABxB"=1, "BBxA"=1, "BBxB"=1)

pikX2 <- function(k)
    c(
      "AAxA"=2/3 + (1/12)*(-1/2)^k-(1/4)*(1/2)^k-((5-3*sqrt(5))/20)*((1-sqrt(5))/4)^k-((5+3*sqrt(5))/20)*((1+sqrt(5))/4)^k,
      "AAxB"=(1/4)*(-1/2)^k+(1/4)*(1/2)^k+((5+sqrt(5))/20)*((1-sqrt(5))/4)^k+((5-sqrt(5))/20)*((1+sqrt(5))/4)^k,
      "ABxA"=(-1/2)*(-1/2)^k + (1/2)*(1/2)^k - (sqrt(5)/5)*((1-sqrt(5))/4)^k + (sqrt(5)/5)*((1+sqrt(5))/4)^k,
      "ABxB"=(1/2)*(-1/2)^k - (1/2)*(1/2)^k - (sqrt(5)/5)*((1-sqrt(5))/4)^k + (sqrt(5)/5)*((1+sqrt(5))/4)^k,
      "BBxA"=(-1/4)*(-1/2)^k-(1/4)*(1/2)^k+((5+sqrt(5))/20)*((1-sqrt(5))/4)^k+((5-sqrt(5))/20)*((1+sqrt(5))/4)^k,
      "BBxB"=1/3+(-1/12)*(-1/2)^k+(1/4)*(1/2)^k-((5-3*sqrt(5))/20)*((1-sqrt(5))/4)^k-((5+3*sqrt(5))/20)*((1+sqrt(5))/4)^k)

nstatesX4 <- c("AAxA"=2, "AAxB"=2, "AAxC"=2, "ABxA"=2, "ABxC"=1, "ACxA"=2, "ACxB"=2, "ACxC"=2, "CCxA"=2, "CCxC"=1)

pikX4 <- function(k)
    c(
      "AAxA"=1/3+(1/24)*(-1/2)^k + (1/8)*(1/2)^k - ((5-2*sqrt(5))/20)*((1-sqrt(5))/4)^k - ((5+2*sqrt(5))/20)*((1+sqrt(5))/4)^k,
      "AAxB"=(1/3)*(-1/4)^k - (1/12)*(1/2)^k - ((5+3*sqrt(5))/40)*((1-sqrt(5))/4)^k - ((5-3*sqrt(5))/40)*((1+sqrt(5))/4)^k,
      "AAxC"=(1/8)*(-1/2)^k-(1/24)*(1/2)^k-(1/3)*(-1/4)^k+((5+sqrt(5))/40)*((1-sqrt(5))/4)^k+((5-sqrt(5))/40)*((1+sqrt(5))/4)^k,
      "ABxA"=-(1/6)*(1/2)^k-(1/3)*(-1/4)^k+((5+sqrt(5))/20)*((1-sqrt(5))/4)^k+((5-sqrt(5))/20)*((1+sqrt(5))/4)^k,
      "ABxC"=(1/3)*(1/2)^k + (2/3)*(-1/4)^k,
      "ACxA"=-(1/4)*(-1/2)^k-(1/12)*(1/2)^k+(1/3)*(-1/4)^k-(sqrt(5)/10)*((1-sqrt(5))/4)^k+(sqrt(5)/10)*((1+sqrt(5))/4)^k,
      "ACxB"=(1/3)*(1/2)^k - (1/3)*(-1/4)^k,
      "ACxC"=(1/4)*(-1/2)^k-(1/4)*(1/2)^k-(sqrt(5)/10)*((1-sqrt(5))/4)^k+(sqrt(5)/10)*((1+sqrt(5))/4)^k,
      "CCxA"=-(1/8)*(-1/2)^k-(1/8)*(1/2)^k+((5+sqrt(5))/40)*((1-sqrt(5))/4)^k+((5-sqrt(5))/40)*((1+sqrt(5))/4)^k,
      "CCxC"=1/3 - (1/12)*(-1/2)^k + (1/4)*(1/2)^k - ((5-3*sqrt(5))/20)*((1-sqrt(5))/4)^k-((5+3*sqrt(5))/20)*((1+sqrt(5))/4)^k)





collapse <- cbind("AAxA"=c(1, 1, 0, 1,    0, 0, 0, 0,   0, 0),
                  "AAxB"=c(0, 0, 1, 0,    1, 0, 0, 0,   0, 0), 
                  "ABxA"=c(0, 0, 0, 0,    0, 1, 1, 0,   0, 0),
                  "ABxB"=c(0, 0, 0, 0,    0, 0, 0, 1,   0, 0),
                  "BBxA"=c(0, 0, 0, 0,    0, 0, 0, 0,   1, 0),
                  "BBxB"=c(0, 0, 0, 0,    0, 0, 0, 0,   0, 1))
  
pikX2p <-
function(k)
  pikX4(k) %*% (collapse * nstatesX4) / nstatesX2

k <- 0:50
maxdif <- rep(NA, length(k))
for(i in seq(along=k))
  maxdif[i] <- max(abs(pikX2(k[i]) - pikX2p(k[i])))
max(maxdif)
